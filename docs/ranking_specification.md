# ランク機能仕様書

## 1. 概要

本ドキュメントは、アプリケーションにおけるランクシステムの仕様を定義します。
ランクは、プレイヤーのゲーム内でのパフォーマンス（スコア）に基づいて決定され、記念カードの背景やランキング表示に利用されます。

## 2. ランクの種類とスコア閾値

ランクは全8段階で構成されます。プレイヤーのスコアが下記に示す閾値に達すると、対応するランクが付与されます。スコアが複数のランクの条件を満たす場合は、最も上位のランクが適用されます。

| ランク名 | ランクID | 最低必要スコア |
| :--- | :--- | :--- |
| ビギナー | `beginner` | 0 |
| アマチュア | `amateur` | 80 |
| アドバンス | `advanced` | 150 |
| エキスパート | `expert` | 250 |
| ベテラン | `veteran` | 400 |
| エリート | `elite` | 600 |
| マスター | `master` | 800 |
| レジェンド | `legend` | 1000 |


### 補足
- **`ランクID`** は、記念カードの背景画像ファイル名 (`bg-card-rank-*-<id>.png`) と対応しています。

## 3. ランク決定ロジック

ランクの決定は、ゲーム結果のスコアを基に行われます。具体的なロジックは以下の通りです。

1. ゲーム終了時にプレイヤーの最終スコアが確定します。
2. 上記の「ランクの種類とスコア閾値」テーブルを参照し、最終スコアがどのランクの条件を満たすか判定します。
3. 条件を満たす最も高いランクが、そのプレイ結果のランクとして記録されます。

**例:**
- スコアが `950` の場合、ランクは「アマチュア」になります。
- スコアが `4200` の場合、ランクは「マスター」になります。

## 4. 関連ファイル

本仕様に関連するソースコードは以下の通りです。

- **ランク定義と決定ロジック**:
  - `src/shared/utils/constants.ts`
    - `RANKS` 定数: ランク名、ID、スコア閾値の定義
    - `getRank(score)` 関数: スコアからランクを決定するロジック

- **データ構造（型定義）**:
  - `src/shared/types/results.ts`: 個別のゲーム結果のデータ構造
  - `src/shared/types/ranking.ts`: ランキング全体のデータ構造

- **データ処理**:
  - `src/main/services/results-manager.ts`: ゲーム結果を保存・管理するクラス
  - `src/main/services/ranking-service.ts`: ランキングデータを読み込み、提供するサービスクラス
