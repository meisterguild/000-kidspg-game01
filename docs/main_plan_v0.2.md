以下が、KidsPG「(仮称)よけまくり中」ゲームの要件定義書です。

---

````markdown
# KidsPG「(仮称)よけまくり中」ゲーム 要件定義書

## 1. 🎯 目的・コンセプト

- 子ども向けの短時間集中型チャレンジゲーム
- 両手人差し指のみのシンプル操作でプレイ
- プレイ後、顔写真・二つ名・スコアをAI加工し記念カード化
- 成績はローカルで保存され、後日Web上にランキングとして公開

---

## 2. 🕹 ゲーム仕様

### 基本操作

| キー     | 機能                         |
|----------|------------------------------|
| ← / →    | キャラクターの左右移動       |
| Space    | スタート／進行／撮影確定     |
| Esc      | どの画面からもトップに戻る（強制リセット） |

### ゲーム内容

- 3レーンで移動し、上から落ちる障害物を回避
- 成績に応じて「Lv1〜MAX」へ成長
- レベルアップゲージあり
- プレイ終了後、スコア・レベル・二つ名を表示し、記念カード生成

---

## 3. 📸 カメラ撮影と二つ名選択

### 画面レイアウト

- 左70%：二つ名ボタン群（択一式、折り返し表示）
- 右30%：カメラプレビュー＆操作エリア

### 二つ名ボタン仕様

- 初期選択：「ランダム」
- 選択中：赤色・凹み（押下感）
- 未選択：淡い青・膨らみ（未選択感）
- 横並び、ラップ表示（Flex-Wrap）

### 撮影仕様

- 撮影画像は常に **500×500px（正方形PNG）** にリサイズ
- 表示時は画面サイズに合わせて拡大（object-fit: contain）
- フォントサイズは `rem` や `vw` 単位で拡大対応
- 撮影確定：Space ／ 戻る：画面上ボタン（マウス）

---

## 4. 🔄 画面遷移設計

```mermaid
flowchart TD
  TOP[🏠 トップページ]
  CAMERA[📸 カメラ撮影]
  COUNTDOWN[⏳ カウントダウン（3秒）]
  GAME[🎮 ゲームプレイ]
  RESULT[🏁 結果表示]

  TOP -->|Space| CAMERA
  CAMERA -->|Space| COUNTDOWN
  COUNTDOWN -->|Auto(3s)| GAME
  GAME -->|Auto(end)| RESULT
  RESULT -->|Space / Esc / Auto(30s)| TOP

  CAMERA -->|Esc| TOP
  COUNTDOWN -->|Esc| TOP
  GAME -->|Esc| TOP
````

* `RESULT`に到達時点で、データは有効扱いとなり記録される
* `RESULT`画面は30秒間無操作でトップへ自動遷移

---

## 5. 🗂 ファイル出力仕様

### 保存構成

```
results/       ← プレイ結果(JSON)
cards/         ← 加工画像(PNG)
public/        ← n8n生成の静的ランキングHTML
```

### result.json 構造

```json
{
  "nickname": "漆黒の牙",
  "rank": "鬼",
  "level": "MAX",
  "score": 9999,
  "timestampJST": "2025-08-06 14:32:00",
  "imagePath": "cards/shikkoku_20250806_1432.png"
}
```

---

## 6. 🌐 ランキング表示とWeb公開

* n8nが `results/*.json` を読み込み、以下を生成：

  * `public/rankings.json`
  * `public/index.html`
* ランキング表示軸：

  * `recent`：最新順
  * `top`：スコア順
* イベント中はElectronが `index.html` を**別ウィンドウで常時表示**
* イベント終了後、`public/` 一式を**Webサーバーにアップロード**し公開

---

## 7. 🤖 AI画像生成仕様

* ComfyUI（セルフホスト）をローカルで起動
* Electronから撮影画像（Base64）を送信し、画像を生成
* 加工後の画像は `cards/` に保存され、`result.json` にパスが記録される

---

## 8. ⚙ 技術構成

| レイヤー    | 技術スタック                         |
| ------- | ------------------------------ |
| UI      | Electron + React + TailwindCSS |
| ゲームロジック | PixiJS または Phaser              |
| 撮影・画像処理 | WebRTC + Canvas（500×500）       |
| ファイル出力  | Node.js (`fs`モジュール)            |
| AI画像加工  | ComfyUI API（ローカルホスト）           |
| 静的ページ生成 | n8n（cron or 手動トリガー）            |
| 公開      | イベント後、Webサーバーへアップロード           |

---

## ✅ 備考と運用方針

* アプリはネット未接続でフル動作
* ランキングはイベント中はローカルブラウザで常時表示
* 公開はイベント後、ファイルを手動アップロードで実施
* 外部モニター利用時はElectronで `BrowserWindow` を分離表示

---

