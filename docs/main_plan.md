以下は、前回の要件定義書に\*\*「ファイル出力と技術スタックに関する要件」を統合した完全版の要件定義書\*\*です。
ゲーム仕様、AI活用、ファイル出力、技術選定まで含め、PoCとして実装可能な構成でまとめております。

---

# 要件定義書：KidsPG「xxチャレンジ系」没入型教育ゲーム

## 1. 背景と目的

子ども向けプログラミング教育コンテンツ「KidsPG」の一環として、子どもが両手の指先のみで簡単に操作できる没入型ゲームを提供する。反射神経・集中力・リズム感覚を養うとともに、AIによるキャラクター生成・演出により自己表現や承認体験を促進し、記憶に残る体験を創出する。

---

## 2. システム全体構成

| コンポーネント    | 概要                              |
| ---------- | ------------------------------- |
| ゲームアプリ     | 操作・演出・障害物処理・プレイ結果出力・顔画像のAI加工処理  |
| 外部モニター表示   | プレイ結果・AI生成ニックネーム・ランキング・記念画像を表示  |
| POC用Webサイト | ランキング一覧と記念画像のスマートフォン閲覧・ダウンロード対応 |
| AI画像加工機構   | 顔写真をポケカ風に加工し、ニックネームとスコアで装飾する    |

---

## 3. 操作仕様

* **操作キー**：

  * スペースキー（ジャンプ）
  * ↓キー（回避）
* **操作方法**：両手の人差し指のみで操作可能なUI設計
* **難易度調整**：プレイ時間やスコアに応じて徐々にスピード・障害物頻度が上昇
* **ゲーム形式**：音ゲー的テンポ・3ライン移動・障害物回避型アクション

---

## 4. ゲーム内容と要素

### 4.1 キャラクターと演出

* 左右に動くキャラクター（3レーン移動）
* 障害物は上から落下し、回避失敗時に破裂演出
* レベルアップに応じて背景演出・効果音が進化
* キャラ・エフェクトは可変（例：かたつむり、犬、鬼など）

### 4.2 レベルと進行

* レベル：Lv1～Lv3、MAXレベル（以降無限モード）
* 成長ゲージ（バロメーター）によってレベルアップ可視化

---

## 5. ファイル出力とデータ構成

### 5.1 出力対象ファイル

| 種別       | 内容                      | 形式             |
| -------- | ----------------------- | -------------- |
| プレイ結果データ | ニックネーム、レベル、スコア、キャラ種別、日時 | JSON / CSV     |
| 記念画像     | AI加工済みの顔写真に装飾を加えたカード風画像 | PNG            |
| ランキングデータ | スコア順の記録一覧（ゲーム内保存＋Web表示） | JSON / CSV     |
| Web表示用   | 記念画像URL、ランキング用JSON      | HTML+JS+画像ファイル |

### 5.2 保存場所と命名規則

* ローカルPC内 `/results/` `/cards/` ディレクトリに保存
* 命名規則：`[ニックネーム]_[日時].json` / `card_[ニックネーム]_[日時].png`

---

## 6. 技術スタック

| 区分       | 技術構成                                       | 備考                  |
| -------- | ------------------------------------------ | ------------------- |
| ゲームUI    | HTML5 + TypeScript + PixiJS または Phaser     | ブラウザベース、Canvasで演出制御 |
| ファイル出力   | Node.js（fs）、または file-saver.js（フロント）        | 結果・記念画像保存に使用        |
| 記念画像生成   | HTML5 Canvas（クライアント） or Python Pillow（サーバ） | ポケカ風演出用             |
| AI加工     | 軽量text-to-imageモデル（Diffusers, LoRA等）       | オフライン・ローカル実行前提      |
| サーバ構成    | Node.js + Express                          | APIでデータ保存・画像配信      |
| ランキングサイト | Next.js または Astro + TailwindCSS            | スマホで見やすく、画像DLも対応    |

---

## 7. 外部モニター表示機能

* ゲーム本体とは別ウィンドウでモニター用UIを表示
* 表示内容：

  * AI加工済み顔写真
  * ニックネーム（中二風：AI生成）
  * キャラ・レベル・スコア
  * 記念画像（ポケカ風）
  * ランキング順位

---

## 8. AI活用要件

| 項目       | 内容                               |
| -------- | -------------------------------- |
| 顔画像加工    | 顔写真を受け取り、加工フィルタを適用（光彩、属性背景など）    |
| ニックネーム生成 | ランダム単語・辞書ベースで中二風ワードを生成（例：「漆黒の牙」） |
| 実行環境     | ローカル実行可能な軽量モデル構成を前提（オフライン対応）     |

---

## 9. その他仕様と留意点

* 保存ファイルにはタイムスタンプ・乱数を含め、重複防止
* 顔画像はセッション内保存とし、終了時に削除オプションを提供
* 子どもが自然に楽しめるようUIや演出の過度な複雑化を避ける
* ランキングページはURL共有型（スマホ閲覧想定）とし、画像DL対応

---

以上が、KidsPG「xxチャレンジ系」ゲームの要件定義書（ファイル出力含む）となります。
