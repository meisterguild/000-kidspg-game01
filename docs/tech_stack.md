### 設計方針

要件定義書（main_plan_v0.2.md）に基づき、以下の技術アーキテクチャで実装します：

1.  **Electronアプリケーション**: スタンドアロン実行可能な統合アプリケーション
2.  **ComfyUIローカル連携**: AI画像加工のためのセルフホストAPI
3.  **n8n静的ページ生成**: ランキングHTMLの自動生成システム

オフライン完結型のイベント向けアプリケーションとして設計し、外部サーバーへの依存を最小限に抑えます。

---

### 技術スタック詳細

| 区分 | コンポーネント | 選定技術 | 選定理由 |
| :--- | :--- | :--- | :--- |
| **デスクトップアプリ** | **アプリケーション基盤** | **Electron** | クロスプラットフォーム対応、ローカルファイルシステムへの完全アクセス、WebRTCカメラ機能、外部ウィンドウ表示機能を統合的に提供 |
| | **UIフレームワーク** | **React + TypeScript** | コンポーネントベースの保守性、型安全性、豊富なエコシステム。Electronとの統合実績が豊富 |
| | **スタイリング** | **TailwindCSS** | ユーティリティファーストでレスポンシブ対応、プロトタイプから本格運用まで一貫した開発体験 |
| | **ゲームエンジン** | **PixiJS** | 軽量で高速な2Dレンダリング。3レーン移動ゲームに最適、Electronとの親和性良好 |
| **画像処理** | **カメラ撮影** | **WebRTC MediaDevices API** | ブラウザ標準API、500×500px正方形リサイズ機能をCanvas APIと組み合わせて実現 |
| | **AI画像加工** | **ComfyUI API** | セルフホスト可能、ワークフロー指向で柔軟な画像生成、ローカル実行でプライバシー保護 |
| | **記念カード生成** | **HTML5 Canvas API** | 二つ名・スコア・レベル情報の合成、PNG出力機能 |
| **データ管理** | **ファイル出力** | **Node.js fs モジュール** | JSON形式でのプレイ結果保存、画像ファイル管理、Electronの特権プロセスで実行 |
| | **ランキング生成** | **n8n** | results/*.json を読み込み、public/index.html を自動生成。cron実行でランキング更新 |
| **表示・公開** | **ランキング表示** | **Electron BrowserWindow** | イベント中の外部モニター表示、別ウィンドウでindex.htmlを常時表示 |
| | **Web公開** | **静的ファイルサーバー** | イベント後、public/ 一式を任意のWebサーバーにアップロードして公開 |

---

### バージョン依存関係

以下のバージョンを推奨します。これらは2025年8月時点での安定性と互換性を考慮して選定しています。

| 区分 | 技術 | 推奨バージョン | 備考 |
| :--- | :--- | :--- | :--- |
| **共通** | **Node.js** | `~22.x` (LTS) | Electron実行環境の基盤 |
| | **Python** | `~3.13` | ComfyUI・n8n実行環境 |
| **Electronアプリ** | **Electron** | `~33.0.0` | デスクトップアプリケーション基盤 |
| | **React** | `~18.3.0` | UIフレームワーク（Electron安定版対応） |
| | **TypeScript** | `~5.6.0` | 静的型付け |
| | **TailwindCSS** | `~3.4.0` | CSSフレームワーク |
| | **PixiJS** | `~8.x` | 2Dゲームエンジン |
| **AI画像処理** | **ComfyUI** | `latest` | セルフホストAI画像生成 |
| | **n8n** | `~1.60.0` | ワークフロー自動化・静的ページ生成 |
| **開発支援** | **Vite** | `~6.0.0` | 高速ビルドツール（Electron統合） |
| | **ESLint** | `~9.0.0` | コード品質保持 |
| | **Prettier** | `~3.3.0` | コードフォーマッター |

---

### システム構成図（概要）

```
[ユーザー] --> [Electronアプリケーション]
                     |
    +----------------+----------------+
    |                |                |
    v                v                v
[メインウィンドウ]    [外部モニター]      [ローカル処理]
    |               |               |
React UI         ランキング表示     ファイル管理
TailwindCSS      (index.html)      (results/*.json)
PixiJSゲーム      BrowserWindow     (cards/*.png)
WebRTCカメラ                       |
    |                               v
    v                          [ComfyUI API]
[画面遷移フロー]                      |
TOP → CAMERA → COUNTDOWN         AI画像加工
    → GAME → RESULT              (localhost)
         |                           |
         v                           v
    [データ出力]                [記念カード生成]
         |                           |
         +---------------------------+
                     |
                     v
            [n8nワークフロー]
                     |
            静的ページ自動生成
            public/index.html
            public/rankings.json
```

**特徴:**
- **完全オフライン動作**: ネットワーク不要
- **イベント特化設計**: 外部モニター対応
- **プライバシー保護**: ローカル処理完結
