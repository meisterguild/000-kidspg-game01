# 不具合報告：結果画面からの自動トップページ遷移とカウントダウンが機能しない

## 報告日
2025年8月14日

## 報告者
Gemini CLI

## 現象
ゲーム結果画面が表示されてから30秒経過しても、自動的にトップページへ遷移しない。また、画面下部に表示される「XX秒後に自動的にトップ画面に戻ります」のカウントダウン表示が更新されない。

## 再現手順
1.  ゲームをプレイし、結果画面に進む。
2.  結果画面で30秒以上待機する。
3.  トップページへ自動遷移しないこと、およびカウントダウン表示が更新されないことを確認する。

## 期待される動作
*   結果画面が表示されてから30秒後に、自動的にトップページへ遷移する。
*   画面下部のカウントダウン表示が1秒ごとに更新され、残り時間が正しく表示される。

## 考えられる原因
*   **環境差異による挙動の変化**: `src/renderer/pages/ResultPage.tsx` 内の `performSave()` 関数では `window.electronAPI` を使用したファイル保存処理が行われている。`npm run dev` (ブラウザ環境) では `window.electronAPI` が存在しないためこの処理はスキップされるが、Electron環境ではこの非同期処理が実行される。この差異が以下の問題を引き起こしている可能性が高い。
*   **`useEffect` の依存配列の問題（主要因の可能性が高い）**:
    *   `src/renderer/pages/ResultPage.tsx` 内の `useEffect` フックの依存配列に `isSaving` が含まれているため、結果保存処理の完了（`isSaving` が `true` から `false` への変化）のたびに `useEffect` が再実行され、新しい `setInterval` が設定されてしまう。これにより、タイマーが多重に起動したり、意図せずリセットされたりする「タイマーの多重起動/リセット」が発生し、カウントダウンが正しく進まない、または自動遷移が遅延・停止する。
    *   特にElectron環境では、ファイル保存処理が非同期で行われ、`isSaving` の状態が `true` になっている間、または処理が完了して `false` に戻るまでの間に `useEffect` が再評価され、タイマーがリセットされる頻度が高くなる。
    *   同様に、`score`, `nickname`, `capturedImage`, `onRestart` のいずれかが変更された場合もタイマーがリセットされるが、`isSaving` の変化が最も頻繁に発生しうるトリガーである。
*   **`autoRestartTimer` の状態更新とUI反映**:
    *   `autoRestartTimer` は `useState` で管理されており、値が更新されればUIに反映されるはずである。カウントダウン表示が更新されないのは、上記「タイマーの多重起動/リセット」により、`autoRestartTimer` の値がそもそも正しく更新されていないためと考えられる。
*   **`onRestart()` コールバックの機能不全**:
    *   `onRestart()` コールバックが呼び出されても、トップページへの遷移が正しく行われていない可能性がある。このコールバックは親コンポーネントから渡されるため、`ResultPage` の親コンポーネントにおける `onRestart` の実装（例: ルーティングの変更処理）も確認が必要となる。

## 関連ファイル/コード
*   `src/renderer/pages/ResultPage.tsx` (特に `useEffect` フック内の `setInterval` と `autoRestartTimer` の管理箇所)

## 修正状況
*   **ステータス**: 修正済み
*   **修正コミット**: 
*   **修正日**: 
*   **修正者**: 
*   **備考**: 

